'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactNative=require('react-native');var _reactNativeFcm=require('react-native-fcm');var _reactNativeFcm2=_interopRequireDefault(_reactNativeFcm);var _mongoidJs=require('mongoid-js');var _lodash=require('lodash');var _lodash2=_interopRequireDefault(_lodash);var _Idx=require('./Idx');var _Idx2=_interopRequireDefault(_Idx);var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _user=require('../redux/modules/user');var userActions=_interopRequireWildcard(_user);var _bookings=require('../redux/modules/bookings');var bookingActions=_interopRequireWildcard(_bookings);var _nav=require('../redux/modules/nav');function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var notificationListener=void 0,refreshTokenListener=void 0;function pushNotificationInit(store){var _this=this;_reactNativeFcm2.default.requestPermissions();_reactNativeFcm2.default.getFCMToken().then(function(token){console.log("DeviceToken=> ",token);if(token){store.dispatch(userActions.setDeviceToken(token));}});_reactNativeFcm2.default.getInitialNotification().then(function(res){var context=_this;console.log("getInitialNotification==> ",res);if((0,_Idx2.default)(res,function(_){return _.fcm.action;})){setTimeout(function(){onNotificationRedirection(res,store);},500);}});notificationListener=_reactNativeFcm2.default.on(_reactNativeFcm.FCMEvent.Notification,function _callee(res){var context;return regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:context=_this;console.log("notificationListener==> ",res);if(res.notificationType==="2"||res.notificationType==="5"||res.opened_from_tray){setTimeout(function(){onNotificationRedirection(res,store);},500);}case 3:case'end':return _context.stop();}}},null,_this);});refreshTokenListener=_reactNativeFcm2.default.on(_reactNativeFcm.FCMEvent.RefreshToken,function(token){if(token){console.log("refresh",token);store.dispatch(userActions.setDeviceToken(token));}});}function onNotificationRedirection(res,store){if((0,_Idx2.default)(store.getState().user,function(_){return _.userDetails.auth.token;})){}if(_lodash2.default.isFunction(res.finish)){res.finish();};}function pushNotificationRemove(store){notificationListener.remove();refreshTokenListener.remove();}exports.default={pushNotificationInit:pushNotificationInit,pushNotificationRemove:pushNotificationRemove};